library(openxlsx)
data<-read.xlsx("Indicatori_Intero_territorio_nazionale.xlsx",sheet = 1,colNames = TRUE)
#data contains , instead of . as decimal delimiter. We need to replace it
#in order to make the columns that should be numerical, numerical.
for (i in 1:397){
  data[,i]<-gsub(",",".",data[,i])
}

indexes_to_numerical<-c("ALT_LOC_AB",
                        "SUP",
                        "SUP_P",
                        "SUP_R",
                        "SUP_URB",
                        "SUP_URB_P",
                        "SUP_URB_R",
                        "ALT_MIN",
                        "ALT_MIN_P",
                        "ALT_MIN_R",
                        "ALT_MAX",
                        "ALT_MAX_P",
                        "ALT_MAX_R",
                        "DENSPOP",
                        "DENSPOP_P",
                        "DENSPOP_R",
                        "VECCH",
                        "VECCH_P",
                        "VECCH_R",
                        "POP_ANZ",
                        "POP_ANZ_P",
                        "POP_ANZ_R",
                        "IND_DIP_STR",
                        "IND_DIP_STR_P",
                        "IND_DIP_STR_R",
                        "POP_2011",
                        "POP_2011_P",
                        "POP_2011_R",
                        "FAM_2011",
                        "FAM_2011_P",
                        "FAM_2011_R",
                        "VAR_PERC",
                        "VAR_PERC_P",
                        "VAR_PERC_R",
                        "ETA_Q1",
                        "ETA_Q2",
                        "ETA_Q3",
                        "ETA_Q4",
                        "ETA_Q4_P",
                        "ETA_Q3_P",
                        "ETA_Q2_P",
                        "ETA_Q1_P",
                        "ETA_Q1_R",
                        "ETA_Q2_R",
                        "ETA_Q3_R",
                        "ETA_Q4_R",
                        "IDEM",
                        "IDEM_P",
                        "IDEM_R",
                        "IVSM",
                        "POP_2018",
                        "POP_2018_P",
                        "POP_2018_R",
                        "FAM_2018",
                        "FAM_2018_P",
                        "FAM_2018_R",
                        "AGMAX_50",
                        "AGMIN_50",
                        "PAI_AREAP4",
                        "PAI_AREAP3",
                        "PAI_AREAP2",
                        "PAI_AREAP1",
                        "PAI_AREAAA",
                        "PAI_AREAP3_P4",
                        "PAI_AREAAA_P",
                        "PAI_AREAAA_R",
                        "PAI_AREAP1_P",
                        "PAI_AREAP1_R",
                        "PAI_AREAP2_P",
                        "PAI_AREAP2_R",
                        "PAI_AREAP3_P",
                        "PAI_AREAP3_R",
                        "PAI_AREAP3_P4_P",
                        "PAI_AREAP3_P4_R",
                        "PAI_POPP4",
                        "PAI_POPP3",
                        "PAI_POPP2",
                        "PAI_POPP1",
                        "PAI_POPAA",
                        "PAI_POPAA_P",
                        "PAI_POPAA_R",
                        "PAI_POPP1_P",
                        "PAI_POPP1_R",
                        "PAI_POPP2_P",
                        "PAI_POPP2_R",
                        "PAI_POPP3_P",
                        "PAI_POPP3_R",
                        "PAI_POPP4_P",
                        "PAI_POPP4_R",
                        "PAI_POPP3_P4",
                        "PAI_POPP3_P4_P",
                        "PAI_POPP3_P4_R",
                        "IDR_POPP3",
                        "IDR_POPP2",
                        "IDR_POPP1",
                        "IDR_POPP1_P",
                        "IDR_POPP1_R",
                        "IDR_POPP2_P",
                        "IDR_POPP2_R",
                        "IDR_POPP3_P",
                        "IDR_POPP3_R",
                        "IDR_AREAP1",
                        "IDR_AREAP1_P",
                        "IDR_AREAP1_R",
                        "IDR_AREAP2",
                        "IDR_AREAP2_P",
                        "IDR_AREAP2_R",
                        "IDR_AREAP3",
                        "IDR_AREAP3_P",
                        "IDR_AREAP3_R","E3",
                        "E3_P",
                        "E3_R",
                        "E5",
                        "E6",
                        "E7",
                        "E6_P",
                        "E6_R",
                        "E5_P",
                        "E5_R",
                        "E7_P",
                        "E7_R",
                        "E8",
                        "E9",
                        "E10",
                        "E11",
                        "E12",
                        "E13",
                        "E14",
                        "E15",
                        "E16",
                        "E16_P",
                        "E16_R",
                        "E8_P",
                        "E8_R",
                        "E9_P",
                        "E9_R",
                        "E10_P",
                        "E10_R",
                        "E11_P",
                        "E11_R",
                        "E12_P",
                        "E12_R",
                        "E13_P",
                        "E13_R",
                        "E14_P",
                        "E14_R",
                        "E15_P",
                        "E15_R",
                        "E16_XCENT",
                        "E16_XCENT_P",
                        "E16_XCENT_R",
                        "E08_E12",
                        "E08_E12_P",
                        "E13_E15",
                        "E13_E15_P",
                        "E08_E12_R",
                        "E13_E15_R",
                        "E17",
                        "E18",
                        "E19",
                        "E20",
                        "E17_P",
                        "E17_R",
                        "E18_P",
                        "E18_R",
                        "E20_P",
                        "E20_R",
                        "E19_P",
                        "E19_R",
                        "E19_E20",
                        "E19_E20_P",
                        "E19_E20_R",
                        "A2",
                        "A2_P",
                        "A2_R",
                        "A3",
                        "A3_P",
                        "A3_R",
                        "A3_XCENT",
                        "A3_XCENT_P",
                        "A3_XCENT_R",
                        "E28",
                        "E28_P",
                        "E28_R",
                        "E29",
                        "E29_P",
                        "E29_R",
                        "E30",
                        "E30_P",
                        "E30_R",
                        "E31",
                        "E31_P",
                        "E31_R",
                        "A7",
                        "A7_P",
                        "A7_R",
                        "A7_XCENT",
                        "A7_XCENT_P",
                        "A7_XCENT_R",
                        "EME8",
                        "EME8_P",
                        "EME8_R",
                        "EME9",
                        "EME9_P",
                        "EME9_R",
                        "EME10",
                        "EME10_P",
                        "EME10_R",
                        "EME11",
                        "EME11_P",
                        "EME11_R",
                        "EME12",
                        "EME12_P",
                        "EME12_R",
                        "EME13",
                        "EME13_P",
                        "EME13_R",
                        "EME14",
                        "EME14_P",
                        "EME14_R",
                        "EME15",
                        "EME15_P",
                        "EME15_R",
                        "EME16",
                        "EME16_P",
                        "EME16_R",
                        "EMP1",
                        "EMP1_P",
                        "EMP1_R",
                        "EMP2",
                        "EMP2_P",
                        "EMP2_R",
                        "EMP3",
                        "EMP3_P",
                        "EMP3_R",
                        "EMC_O",
                        "EMC_O_P",
                        "EMC_O_R",
                        "EMC_B",
                        "EMC_B_P",
                        "EMC_B_R",
                        "EMC_M",
                        "EMC_M_P",
                        "EMC_M_R",
                        "EMC_P",
                        "EMC_P_P",
                        "EMC_P_R",
                        "EP3E1",
                        "EP3E1_P",
                        "EP3E1_R",
                        "EP3E2",
                        "EP3E2_P",
                        "EP3E2_R",
                        "EP3E3",
                        "EP3E3_P",
                        "EP3E3_R",
                        "EP3E4",
                        "EP3E4_P",
                        "EP3E4_R",
                        "EP3E5",
                        "EP3E5_P",
                        "EP3E5_R",
                        "EP3E6",
                        "EP3E6_P",
                        "EP3E6_R",
                        "EP3E7",
                        "EP3E7_P",
                        "EP3E7_R",
                        "EP3E8",
                        "EP3E8_P",
                        "EP3E8_R",
                        "EP3E9",
                        "EP3E9_P",
                        "EP3E9_R",
                        "EP3M",
                        "EP3M_P", 
                        "EP3M_R",
                        "EP3C1",
                        "EP3C1_P",
                        "EP3C1_R",
                        "EP3C2",
                        "EP3C2_P",
                        "EP3C2_R",
                        "EP3C3",
                        "EP3C3_P",
                        "EP3C3_R",
                        "EP3C4",
                        "EP3C4_P",
                        "EP3C4_R",
                        "ERM1",
                        "ERC1",
                        "ERA1",
                        "ERM1_P",
                        "ERC1_P",
                        "ERA1_P",
                        "ERM1_R",
                        "ERC1_R",
                        "ERA1_R",
                        "EP3C",
                        "EP3C_P",
                        "EP3C_R",
                        "EC8_12",
                        "EC13_15",
                        "EC16",
                        "EC8_12_P",
                        "EC13_15_P",
                        "EC16_P",
                        "EC8_12_R",
                        "EC13_15_R",
                        "EC16_R",
                        "ECP3_8_12",
                        "ECP3_13_15",
                        "ECP3_16",
                        "ECP3_8_12_P",
                        "ECP3_13_15_P",
                        "ECP3_16_P",
                        "ECP3_8_12_R",
                        "ECP3_13_15_R",
                        "ECP3_16_R",
                        "ERE8",
                        "ERE9",
                        "ERE10",
                        "ERE11",
                        "ERE12",
                        "ERE13",
                        "ERE14",
                        "ERE15",
                        "ERE16",
                        "ERE8_P",
                        "ERE9_P",
                        "ERE10_P",
                        "ERE11_P",
                        "ERE12_P",
                        "ERE13_P",
                        "ERE14_P",
                        "ERE15_P",
                        "ERE16_P",
                        "ERE8_R",
                        "ERE9_R",
                        "ERE10_R",
                        "ERE11_R",
                        "ERE12_R",
                        "ERE13_R",
                        "ERE14_R",
                        "ERE15_R",
                        "ERE16_R",
                        "TOT_BENI",
                        "TOT_BENI_P",
                        "TOT_BENI_R",
                        "TOT_ARCHIT",
                        "TOT_ARCHIT_P",
                        "TOT_ARCHIT_R",
                        "TOT_ARCHEO",
                        "TOT_ARCHEO_P",
                        "TOT_ARCHEO_R",
                        "TOT_PARC_GIAR",
                        "TOT_PARC_GIAR_P",
                        "TOT_PARC_GIAR_R",
                        "ERECEM",
                        "ERESPP",
                        "EREMP")


#indexes_to_integer<-c()


indexes_to_factor<-c("ID_REGIONE",
                     "DZREG",
                     "LIT",
                     "LIT_TXT",
                     "PRES_EUAP",
                     "PRES_EUAP_TXT",
                     "PRES_NAT00",
                     "DEGREE_URB_TXT",
                     "ZNVULC_G",
                     "ZNVULC_G_TXT",
                     "ZNVULC_R",
                     "ZNVULC_R_TXT",
                     "ZNVULC_MVPU",
                     "ZNVULC_SOM",
                     "ZNVULC_SOM_TXT",
                     "ZNVULC_ALTRI",
                     "ZNVULC_ALTRI_TXT")

indexes_to_orinal<-c("ZONA_ALT",
                     "CLASSE_COMUNE",
                     "DEGREE_URB",
                     "COMUNE_MONTANO",
                     "ERECQ")


indexes_to_delete<-c("DATA_RIF","MACRO_CLASSE","MACRO_CLASSE_TXT")
#data$DATA_RIF -- only one date of reference

for (i in indexes_to_numerical){
  data[,i]<-as.numeric(data[,i])
}

for (i in indexes_to_delete){
  data[,i]<-c()
}


for (i in indexes_to_factor){
  data[,i]<-as.factor(data[,i])
}

for (i in indexes_to_orinal){
  data[,i]<-as.ordered(data[,i])
}

library(sp)
library(rgdal)
library(tidyverse)
library(raster)
library(readr)
library(readxl)
library(sf)
library(maps)
library(spData)
library(grid)
library(tmap)


comunes <- read_sf("Com01012018_g_WGS84.shp")
regions <- read_sf("Reg01012018_g_WGS84.shp")
comunes$PRO_COM<-c()
names(comunes)[names(comunes) == "PRO_COM_T"] <- "PROCOM"


comunesmerged <- merge(comunes, data, by=c("PROCOM"), all.x = TRUE, all.y=FALSE) 
save.image(file = "mergeddata.RData")

 
